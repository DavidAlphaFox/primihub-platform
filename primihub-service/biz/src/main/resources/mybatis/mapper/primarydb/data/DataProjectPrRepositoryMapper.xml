<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.primihub.biz.repository.primarydb.data.DataProjectPrRepository">

    <insert id="saveProject" useGeneratedKeys="true" keyProperty="projectId" parameterType="com.primihub.biz.entity.data.po.DataProject">
        insert into data_project (project_name,project_desc,organ_id,organ_num,resource_num,resource_organ_ids,auth_resource_num,user_id,create_date,update_date)
        values (#{projectName},#{projectDesc},#{organId},#{organNum},#{resourceNum},#{resourceOrganIds},#{authResourceNum},#{userId},now(),now())
    </insert>

    <insert id="saveProjectResource" parameterType="com.primihub.biz.entity.data.po.DataProjectResource">
        insert into data_pr (project_id,resource_id,is_authed,create_date,update_date)
        values
        <foreach collection="projectResources" index="index" item="item" separator=",">
            (#{item.projectId},#{item.resourceId},#{item.isAuthed},now(),now())
        </foreach>
    </insert>

    <update id="editProject" parameterType="com.primihub.biz.entity.data.po.DataProject">
        update data_project
        <set>
            <if test="projectName!=null">
                project_name = #{projectName},
            </if>
            <if test="projectDesc!=null">
                project_desc = #{projectDesc},
            </if>
            <if test="organId!=null">
                organ_id = #{organId},
            </if>
            <if test="organNum!=null">
                organ_num = #{organNum},
            </if>
            <if test="resourceNum!=null">
                resource_num = #{resourceNum},
            </if>
            <if test="resourceOrganIds!=null">
                resource_organ_ids = #{resourceOrganIds},
            </if>
            <if test="authResourceNum!=null">
                auth_resource_num = #{authResourceNum},
            </if>
            <if test="userId!=null">
                user_id = #{userId},
            </if>
            update_date = now()
        </set>
        where project_id = #{projectId}
    </update>

    <update id="updateProjectResourceStatus">
        update data_pr
         set
            is_authed = #{status},
            update_date = now()
        where project_id = #{projectId} and resource_id = #{resourceId}
    </update>
    <update id="updateProjectAuthNum">
        update data_project set auth_resource_num = auth_resource_num + 1 where project_id = #{projectId}
    </update>

    <delete id="delDataProject">
        delete from data_project where project_id = #{projectId}
    </delete>

</mapper>